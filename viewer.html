<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flipbook Viewer</title>
<style>
body,html { margin:0; padding:0; height:100%; background:#0b0c10; font-family:sans-serif; color:#fff; }
#flipbookWrapper { width:100%; height:100%; display:flex; justify-content:center; align-items:center; }
#flipbook { width:90%; height:90%; }
.page { width:100%; height:100%; display:flex; justify-content:center; align-items:center; background:#fff; overflow:hidden; }
.page canvas { width:100%; height:100%; object-fit:contain; }
.controls { position:absolute; top:12px; right:12px; display:flex; gap:8px; z-index:10; }
.controls button { padding:8px 10px; border-radius:8px; border:none; cursor:pointer; background:#ff7a59; color:#fff; }
</style>
</head>
<body>

<div id="flipbookWrapper">
    <div id="flipbook"></div>
</div>

<div class="controls">
    <button id="prevBtn">◀ Prev</button>
    <button id="nextBtn">Next ▶</button>
    <button id="zoomIn">Zoom +</button>
    <button id="zoomOut">Zoom −</button>
</div>

<!-- PDF.js -->
<script src="https://unpkg.com/pdfjs-dist@3.11.349/build/pdf.min.js"></script>
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<!-- Turn.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/4.1.0/turn.min.js"></script>

<script>
(function(){
    // Check authorization
    if(localStorage.getItem('flipbookAuthorized') !== 'true'){
        alert('Unauthorized. Please enter the passcode.');
        window.location.href = 'index.html';
    }

    const PDF_URL = 'physics.pdf'; // PDF is in same folder
    const flipbookEl = document.getElementById('flipbook');

    async function loadPDF() {
        const loadingTask = pdfjsLib.getDocument({url: PDF_URL});
        const pdf = await loadingTask.promise;
        const numPages = pdf.numPages;

        for(let i=1; i<=numPages; i++){
            const page = await pdf.getPage(i);
            const viewport = page.getViewport({ scale:1.5 });
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            await page.render({canvasContext:ctx, viewport}).promise;

            const pageDiv = document.createElement('div');
            pageDiv.className = 'page';
            pageDiv.appendChild(canvas);
            flipbookEl.appendChild(pageDiv);
        }

        // Initialize turn.js
        $('#flipbook').turn({
            width: flipbookEl.clientWidth,
            height: flipbookEl.clientHeight,
            autoCenter: true,
            elevation: 50,
            acceleration: true,
            gradients: true,
            duration: 800,
            page: 1
        });

        // Controls
        document.getElementById('prevBtn').onclick = ()=> $('#flipbook').turn('previous');
        document.getElementById('nextBtn').onclick = ()=> $('#flipbook').turn('next');

        let zoomScale = 1;
        document.getElementById('zoomIn').onclick = ()=>{
            zoomScale = Math.min(2.5, zoomScale+0.25);
            flipbookEl.style.transform = `scale(${zoomScale})`;
            flipbookEl.style.transformOrigin = 'center top';
        };
        document.getElementById('zoomOut').onclick = ()=>{
            zoomScale = Math.max(0.5, zoomScale-0.25);
            flipbookEl.style.transform = `scale(${zoomScale})`;
            flipbookEl.style.transformOrigin = 'center top';
        };
    }

    loadPDF();
})();
</script>

</body>
</html>
